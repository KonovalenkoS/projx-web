angular.module('projx', ['ngRoute'])
.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
    // routing definitions
    $routeProvider
        .when('/home', {
            templateUrl: '/app/views/home/home.html',
            controller: 'homeController'
        })
        .when('/forum', {
            templateUrl: '/app/views/forum/forum.html',
            controller: 'forumController'
        })
        .otherwise({
            redirectTo: '/home'
        });

        // remove # from URL
        $locationProvider.html5Mode({
            enabled: true,
            requireBase: false
        });
    }
])
.component('sidebar', {
    templateUrl: '/app/components/sidebar/sidebar.html',
    controller: 'sidebarController'
});

angular.module('projx').factory('user', function($http) {
    var userService = {};
    var currentUser;

    userService.get = function (cb) {
        if (currentUser) cb(currentUser);
        else {
            $http.get('/api/user/current').then(function (response) {
                currentUser = response.data;
                cb(currentUser);
            });
        }
    }

    return userService;
});

angular.module('projx').controller('sidebarController', function ($scope, $location, user) {
    $scope.go = function (path) {
        $location.path(path);
    }
});

angular.module('projx').controller('forumController', function ($scope) {
    var fakeThreads = [{
        'id': '1',
        'author': 'vfazel',
        'date': 'Jun 8, 2016',
        'title': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.',
        'content': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.'
    }, {
        'id': '12',
        'author': 'vfazel',
        'date': 'Jun 8, 2016',
        'title': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.',
        'content': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.'
    }, {
        'id': '123',
        'author': 'vfazel',
        'date': 'Jun 8, 2016',
        'title': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.',
        'content': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.'
    }, {
        'id': '1234',
        'author': 'vfazel',
        'date': 'Jun 8, 2016',
        'title': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.',
        'content': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.'
    }, {
        'id': '12345',
        'author': 'vfazel',
        'date': 'Jun 8, 2016',
        'title': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.',
        'content': 'Why can\'t I get my header to fit in this card? I want to write a very long header here.'
    }];

    $scope.threads = fakeThreads;

    $scope.truncate = function (text, cutoff) {
        if (text.length > cutoff) {
            return text.substring(0, cutoff) + '...';
        } else {
            return text;
        }
    }
});

angular.module('projx').controller('homeController', function () {});
